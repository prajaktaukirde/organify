jQuery(document).ready(function(e){function i(e,t="error"){return xoo_el_localize.html.notice[t].replace("%s",e)}var t,n,o={"xoo-el-login-tgr":"login","xoo-el-reg-tgr":"register"};function a(e){return o[e]?o[e]:""}function s(e=""){var n,t=!1;return e.length&&e.find('.xoo-el-section[data-section="single"]').length&&(t=!0),n={"xoo-el-sing-tgr":"single","xoo-el-login-tgr":t?"single":"login","xoo-el-reg-tgr":t?"single":"register","xoo-el-lostpw-tgr":"lostpw","xoo-el-resetpw-tgr":"resetpw","xoo-el-forcereg-tgr":"register","xoo-el-forcelogin-tgr":"login"},n}class r{constructor(e){this.$container=e,this.$tabs=e.find("ul.xoo-el-tabs").length?e.find("ul.xoo-el-tabs"):null,this.display=e.hasClass("xoo-el-form-inline")?"inline":"popup",this.$container.attr("data-active")&&this.toggleForm(this.$container.attr("data-active")),this.createFormsTriggerHTML(),this.eventHandlers()}createFormsTriggerHTML(){var t='<div style="display: none!important;">';e.each(s(this.$container),function(e){t+='<span class="'+e+'"></span>'}),t+="</div>",this.$container.append(t)}eventHandlers(){this.$container.on("submit",".xoo-el-action-form",this.submitForm.bind(this)),this.$container.on("click",".xoo-el-edit-em",this.emailFieldEditClick.bind(this)),e(document.body).on("xoo_el_form_submitted",this.singleFormProcess.bind(this)),this.formTriggerEvent()}emailFieldEditClick(t){this.toggleForm("single"),this.$container.find('input[name="xoo-el-sing-user"]').val(e(t.currentTarget).siblings("input").val()).focus().trigger("keyup")}formTriggerEvent(){var t=this,n=s(t.$container);e.each(n,function(n,s){e(t.$container).on("click","."+n,function(e){e.preventDefault(),e.stopImmediatePropagation(),t.toggleForm(s,a(n))})})}toggleForm(t,n=""){this.$container.attr("data-active",t);var i,s=this.$container.find('.xoo-el-section[data-section="'+t+'"]'),o="xoo-el-active";s.length&&(i=s.find("form"),this.$container.find(".xoo-el-section").removeClass(o),s.addClass(o),s.find(".xoo-el-notice").html("").hide(),s.find(".xoo-el-action-form").show(),i.length&&n&&i.find('input[name="_xoo_el_referral"]').length&&i.find('input[name="_xoo_el_referral"]').val(n)),this.$tabs&&(this.$tabs.find("li").removeClass(o),this.$tabs.find('li[data-tab="'+t+'"]').length&&this.$tabs.find('li[data-tab="'+t+'"]').addClass(o)),e(document.body).trigger("xoo_el_form_toggled",[t,this,n])}submitForm(t){t.preventDefault();var s,n=e(t.currentTarget),o=n.find('button[type="submit"]'),c=n.parents(".xoo-el-section"),l=o.text(),a=c.find(".xoo-el-notice"),d=c.attr("data-section"),r=this;o.html(xoo_el_localize.html.spinner).addClass("xoo-el-processing"),s=new FormData(n[0]),s.append("action","xoo_el_form_action"),s.append("display",r.display),e.ajax({url:xoo_el_localize.adminurl,type:"POST",processData:!1,contentType:!1,cache:!1,enctype:"multipart/form-data",data:s,complete:function(e,t){o.removeClass("xoo-el-processing").html(l),(t!=="success"||!e.responseJSON||e.responseJSON.error===void 0)&&(xoo_el_localize.errorLog==="yes"?a.html(i("We could not process your request, please check console or try again later.","error")).show():t!=="error"&&location.reload())},success:function(t){if(t.error===void 0){console.log(t);return}t.notice&&(a.html(t.notice).show(),r.display==="inline"&&e("html, body").animate({scrollTop:a.offset().top-100},500)),t.error===0&&(t.redirect?setTimeout(function(){window.location=t.redirect},xoo_el_localize.redirectDelay):n.hide(),n.trigger("reset"),d==="resetpw"&&n.add(".xoo-el-resetpw-hnotice").remove()),e(document.body).trigger("xoo_el_form_submitted",[t,n,r])}}).fail(function(t){e("body, .xoo-el-popup-notice").addClass("xoo-el-popup-notice-active");var i,a,o=e(".xoo-el-notice-wrap iframe").get(0);o.contentWindow.document.open(),o.contentWindow.document.write(t.responseText),o.contentWindow.document.close(),i=o.contentWindow.document,a=i.createElement("style"),a.textContent=e(".xoo-el-notice-iframestyle").text(),i.head.appendChild(a)})}singleFormProcess(t,n,s,o){if(this!==o)return;if(n.field){var a,i=this.$container.find(n.field);i.length&&(this.toggleForm(i.closest(".xoo-el-section").attr("data-section")),i.closest("form").show(),i.val(n.fieldValue),i.closest(".xoo-el-section").find(".xoo-el-notice").html(n.notice).show(),a=i.closest(".xoo-aff-group"),a.find(".xoo-el-edit-em").length||(a.addClass("xoo-el-block-edit"),e(xoo_el_localize.html.editField).insertAfter(i)))}}}class c{constructor(e){this.$popup=e,this.eventHandlers()}eventHandlers(){this.$popup.on("click",".xoo-el-close, .xoo-el-modal, .xoo-el-opac",this.closeOnClick.bind(this)),e(document.body).on("xoo_el_form_submitted",this.onFormSubmitSuccess.bind(this)),this.$popup.on("click",".xoo-el-action-btn",this.setScrollBarOnSubmit.bind(this)),e(window).on("hashchange load",this.openViaHash.bind(this)),this.triggerPopupOnClick(),xoo_el_localize.checkout&&xoo_el_localize.checkout.loginEnabled==="yes"&&e("body").on("click",".wc-block-checkout__login-prompt, .wc-block-must-login-prompt",this.checkoutPageLinkClick.bind(this)),e(document.body).on("xoo_el_popup_toggled.xooEscEvent",this.onPopupToggled.bind(this))}onPopupToggled(){e("body").hasClass("xoo-el-popup-active")?e(document).on("keydown.xooEscClose",this.closeOnEscPress.bind(this)):e(document).off("keydown.xooEscClose")}closeOnEscPress(){(event.key==="Escape"||event.keyCode===27)&&t.toggle("hide")}checkoutPageLinkClick(t){t.preventDefault(),e(t.currentTarget).attr("data-redirect",xoo_el_localize.checkout.loginRedirect).addClass("xoo-el-login-tgr").trigger("click")}triggerPopupOnClick(){e.each(s(this.$popup),function(n){e(document.body).on("click","."+n,function(s){return!!e(this).parents(".xoo-el-form-container").length||(s.preventDefault(),s.stopImmediatePropagation(),t.toggle("show"),e(this).attr("data-redirect")&&t.$popup.find('input[name="xoo_el_redirect"]').val(e(this).attr("data-redirect")),t.$popup.find("."+n).trigger("click"),!1)})})}toggle(t){var n=this.$popup.add("body"),s="xoo-el-popup-active";t==="show"?n.addClass(s):t==="hide"?n.removeClass(s):n.toggleClass(s),e(document.body).trigger("xoo_el_popup_toggled",[t])}closeOnClick(e){var t=e.target.classList;(t.contains("xoo-el-close")||t.contains("xoo-el-modal")||t.contains("xoo-el-opac"))&&this.toggle("hide")}setScrollbarPosition(e){this.$popup.find(".xoo-el-srcont").scrollTop=e||0}onFormSubmitSuccess(){this.setScrollbarPosition()}setScrollBarOnSubmit(t){var n=e(t.currentTarget).closest("form").find("input:invalid");if(n.length===0)return;this.setScrollbarPosition(n.filter(":first").closest(".xoo-aff-group").position().top)}openViaHash(){if(t=e(location).attr("hash"),t==="#login"||t==="#register"){this.toggle("show");var t,n=window.location.toString(),s=n.substring(0,n.indexOf("#"));window.history.replaceState({},document.title,s)}t==="#login"?this.$popup.find(".xoo-el-login-tgr").trigger("click"):t==="#register"&&this.$popup.find(".xoo-el-reg-tgr").trigger("click")}}class l{constructor(e){this.$form=e}eventHandlers(){}}t=null,e(".xoo-el-container").length&&(t=new c(e(".xoo-el-container"))),xoo_el_localize.autoOpenPopup==="yes"&&localStorage.getItem("xoo_el_popup_opened")!=="yes"&&(xoo_el_localize.autoOpenPopupOnce==="yes"&&localStorage.setItem("xoo_el_popup_opened","yes"),setTimeout(function(){t.toggle("show")},xoo_el_localize.aoDelay)),e(".xoo-el-form-container").each(function(t,n){new r(e(n))}),e("form.xoo-el-form-resetpw").length&&(e(".xoo-el-form-inline").length?e([document.documentElement,document.body]).animate({scrollTop:e(".xoo-el-form-inline").offset().top},500):t&&t.toggle("show")),e("body.woocommerce-checkout").length&&e(".xoo-el-form-inline").length&&e("a.showlogin").length&&(n=e(".xoo-el-form-inline"),n.hide(),e(document.body).on("click","a.showlogin",function(){n.slideToggle(),n.find(".xoo-el-login-tgr").trigger("click")})),t&&xoo_el_localize.loginClass&&e("."+xoo_el_localize.loginClass).length&&e("body:not(.logged-in) ."+xoo_el_localize.loginClass).on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),t.toggle("show"),t.$popup.find(".xoo-el-login-tgr").trigger("click")}),t&&xoo_el_localize.registerClass&&e("."+xoo_el_localize.registerClass).length&&e("body:not(.logged-in) ."+xoo_el_localize.registerClass).on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),t.toggle("show"),t.$popup.find(".xoo-el-reg-tgr").trigger("click")}),e(".xoo-el-notice-close").on("click",function(){e("body, .xoo-el-popup-notice").removeClass("xoo-el-popup-notice-active")})})